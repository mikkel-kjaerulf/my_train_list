{% extends 'base.html' %}

{% block content %}

<script>
    function replaceImage(img) {
    img.src = '/static/placeholder.jpg';  // Set the path to your placeholder image
    }
</script>

<div class="topt-container">
    <h1>Top Trains</h1>

    <div class="grid">
        {% for row in rows %}
            <div class="grid-item">
                <a href="{{ url_for('train_view', name=row[column_with_train_name_index]) }}">
                    <img class="grid-image" src="static/lowres_images/{{ row[column_with_image_index] }}" alt="Image" onerror="replaceImage(this)">
                </a>
                <div class="card">
                    <table>  <!-- Add a table to create columns -->
                        {% for column in row %}
                            {% if not loop.index0 == column_with_image_index and not loop.index0 == rating %}
                                <tr>
                                    <td>{{ headers[loop.index0]}}:</td>  <!-- Create a new column for the header -->
                                    <td>{{ column }}</td>  <!-- Create a new column for the value -->
                                </tr>
                            {% endif %}
                        {% endfor %}
                    </table>
                    <div class="rating-container">
                        <div class="rating-square", id="indicator_{{loop.index0}}">
                          <span class="rating-score">{{row[rating]}}</span>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<script>
    // Retrieve all the rating containers
    var ratingContainers = document.getElementsByClassName('rating-square');

    // Loop through each rating container
    for (var i = 0; i < ratingContainers.length; i++) {
        // Get the rating value
        var rating = parseFloat(ratingContainers[i].querySelector('.rating-score').textContent);

        // Calculate the color value based on the rating
        var colorValue = 1-(rating) / 5; // Normalize the rating to a value between 0 and 1

        // Calculate the HSL values based on the colorValue
        var hue = (1 - colorValue) * 100; // Ranges from 0 to 60
        var saturation = 60; // Adjust the saturation value as desired
        var lightness = 60; // Adjust the lightness value as desired

        // Convert HSL to RGB
        var rgb = hslToRgb(hue, saturation, lightness);

        // Set the background color as the calculated RGB value
        ratingContainers[i].style.backgroundColor = 'rgb(' + rgb[0] + ', ' + rgb[1] + ', ' + rgb[2] + ')';
    }

    // Function to convert HSL to RGB
    function hslToRgb(h, s, l) {
        h /= 360;
        s /= 100;
        l /= 100;
        var r, g, b;
    
        if (s === 0) {
            r = g = b = l; // achromatic
        } else {
            var hueToRgb = function hueToRgb(p, q, t) {
                if (t < 0) t += 1;
                if (t > 1) t -= 1;
                if (t < 1 / 6) return p + (q - p) * 6 * t;
                if (t < 1 / 2) return q;
                if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
                return p;
            };
    
            var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            var p = 2 * l - q;
    
            r = hueToRgb(p, q, h + 1 / 3);
            g = hueToRgb(p, q, h);
            b = hueToRgb(p, q, h - 1 / 3);
        }
    
        return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
    }
    function positionCard() {
  const gridItems = document.querySelectorAll('.grid-item');

  gridItems.forEach((item) => {
    const card = item.querySelector('.card');
    const rect = item.getBoundingClientRect();
    const spaceLeft = rect.left;
    const spaceRight = window.innerWidth - rect.right;

    if (spaceRight < card.offsetWidth) {
      card.style.left = 'auto';
      card.style.right = '100%';
    } else {
      card.style.left = '110%';
      card.style.right = 'auto';
    }
  });
}

window.addEventListener('resize', positionCard);
positionCard();

</script>


{% endblock %}
